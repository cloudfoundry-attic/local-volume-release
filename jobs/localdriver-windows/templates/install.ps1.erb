$ErrorActionPreference = "Stop";
trap { $host.SetShouldExit(1) }

New-Item -ItemType "directory" -Force "<%= p("localdriver.driver_path") %>"
New-Item -ItemType "directory" -Force "<%= p("localdriver.cell_mount_path") %>"

# allow container users to have access to volumes
$path = "<%= p("localdriver.cell_mount_path") %>"
$user = "BUILTIN\Users"
$acl = Get-Acl $path
$arguments = $user, "FullControl", "ContainerInherit, ObjectInherit", "None", "Allow"
$accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule $arguments
$acl.SetAccessRule($accessRule)
$acl | Set-Acl $path

echo "Installed localdriver paths"
Exit 0
